#!/usr/bin/env bash
# Validate commit message format (Conventional Commits subset)
MSG_FILE="$1"
if [ -z "$MSG_FILE" ]; then
  echo "No commit message file specified" >&2
  exit 1
fi
MSG=$(cat "$MSG_FILE")
# Allow commits that fix up or squash by prefix (GH autosquash)
if echo "$MSG" | grep -Eq "^(fixup!|squash!)"; then
  exit 0
fi
# Pattern: type(scope): subject OR type: subject
if ! echo "$MSG" | grep -Eq "^(feat|fix|docs|style|refactor|perf|test|chore|build|ci|revert)(\([a-zA-Z0-9_\-/.]+\))?:\s.+"; then
  echo "ERROR: Commit message does not follow Conventional Commits format." >&2
  echo "Expected: type(scope): subject or type: subject" >&2
  echo "Allowed types: feat, fix, docs, style, refactor, perf, test, chore, build, ci, revert" >&2
  exit 1
fi
exit 0
